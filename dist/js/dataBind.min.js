/* @gogocat/data-bind | version 1.12.0 | By Adam Chow | link https://gogocat.github.io/dataBind/ | license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).dataBind=t()}(this,function(){"use strict";const e={comp:"data-bind-comp",tmp:"data-bind-tmp",text:"data-bind-text",click:"data-bind-click",dblclick:"data-bind-dblclick",blur:"data-bind-blur",focus:"data-bind-focus",hover:"data-bind-hover",input:"data-bind-input",change:"data-bind-change",submit:"data-bind-submit",model:"data-bind-model",show:"data-bind-show",css:"data-bind-css",attr:"data-bind-attr",forOf:"data-bind-for",if:"data-bind-if",switch:"data-bind-switch",case:"data-bind-case",default:"data-bind-default"},t="data-server-rendered",n="data-forOf_",i="data-if_",r="data-case_",o="data-default_",a="_end",l="$root",c="$data",s="$index",d="in",u="out",f="SERVER-RENDERED",p="INIT",h=250,m={ONCE:"once"},g="_parent";function b(){return b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)({}).hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},b.apply(null,arguments)}const y=Array.isArray,v={BAD_TAGS:/<(script|del)(?=[\s>])[\w\W]*?<\/\1\s*>/gi,FOR_OF:/(.*?)\s+(?:in|of)\s+(.*)/,FUNCTION_PARAM:/\((.*?)\)/,HTML_TAG:/^[\s]*<([a-z][^\/\s>]+)/i,OBJECT_LITERAL:/^\{.+\}$/,PIPE:/\|/,WHITE_SPACES:/\s+/g,LINE_BREAKS_TABS:/(\r\n|\n|\r|\t)/gm},E="content"in document.createElement("template"),A={div:["div","<div>","</div>"],thead:["table","<table>","</table>"],col:["colgroup","<table><colgroup>","</colgroup></table>"],tr:["tbody","<table><tbody>","</tbody></table>"],td:["tr","<table><tr>","</tr></table>"]};A.caption=A.colgroup=A.tbody=A.tfoot=A.thead,A.th=A.td;const w=e=>y?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e),C=e=>null!==e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e),P=e=>{if(!C(e))return!1;const t=e.constructor;if("function"!=typeof t)return!1;const n=t.prototype;return!1!==C(n)&&!1!==n.hasOwnProperty("isPrototypeOf")},B=e=>!!C(e)&&0===Object.getOwnPropertyNames(e).length;function O(e){if("string"!=typeof e)return null;if(E){const t=document.createElement("template");return t.innerHTML=function(e=""){return e.replace(v.BAD_TAGS,"")}(e),t.content}const t=document.createDocumentFragment(),n=document.createElement("div"),i=function(e){const t=e.match(v.HTML_TAG);return t?t[1]:null}(e),r=A[i||"div"];if("div"===r[0])return document.createRange().createContextualFragment(e);n.insertAdjacentHTML("beforeend",`${r[1]}${e}${r[2]}`);const o=n.querySelector(r[0]);for(;o&&o.firstChild;)t.appendChild(o.firstChild);return t}const R=["__proto__","constructor","prototype"];function M(e){return!R.includes(e)}const S=(e,t)=>function(e,t,n){const i=t.replace(/\[/g,".").replace(/]/g,"").split(".").filter(Boolean);let r=e;for(const e of i){if(!e||!M(e))return n;if(null==r)return n;if(r=r[e],void 0===r)return n}return r}(e,t),D=(e,t,n)=>((e,t,n)=>{if(Object(e)!==e)return e;let i;i=Array.isArray(t)?t:t.toString().match(/[^.[\]]+/g)||[];for(const t of i)if(!M(t))return console.warn(`Blocked attempt to set dangerous property: ${t}`),e;const r=i[i.length-1],o=i.slice(0,-1).reduce((e,t,n)=>{if(!M(t))return e;if(Object(e[t])===e[t])return e[t];const r=i[n+1];return e[t]=(0|Math.abs(Number(r)))===+r?[]:{},e[t]},e);return M(r)&&(o[r]=n),e})(e,t,n),T=(e,t)=>{let n=t.dataKey,i=t.parameters;const r=n&&"!"===n.charAt(0);r&&n&&(n=r?n.substring(1):n);let o=n?S(e,n):void 0;if("function"==typeof o){const r=j(e,n||""),a=t.elementData?t.elementData.viewModelPropValue:null;i=i?V(e,i):[];const l=i.concat([a,t.el]);o=o.apply(r,l)}return o=r?!o:o,o=x({value:o,viewModel:e,bindingCache:t}),o},x=({value:e,viewModel:t,bindingCache:n})=>{let i=e;return n.filters&&$(n.filters,(e,n)=>{const r=j(t,n),o=S.call(r,r,n);try{i=o.call(r,i)}catch(e){F(e,`Invalid filter: ${n}`)}}),i},N=()=>{const e={};return e.promise=new Promise((t,n)=>{e.resolve=t,e.reject=n}),e},k=(e=!1,t,...n)=>{if(!n.length)return t;const i=n.shift();return void 0===i?t:e?(K(t)&&K(i)&&Object.keys(i).forEach(e=>{K(i[e])?(t[e]||(t[e]={}),k(!0,t[e],i[e])):t[e]=i[e]}),k(!0,t,...n)):b(t,i,...n)},$=(e,t)=>{if("object"!=typeof e||"function"!=typeof t)return;let n=[],i=0;const r=w(e);let o,a,l=0;if(r)i=e.length;else{if(!C(e))throw new TypeError("Object is not an array or object");n=Object.keys(e),i=n.length}for(l=0;l<i;l+=1)r?(o=l,a=e[l]):(o=n[l],a=e[o]),t(o,a)},K=e=>C(e)&&!w(e),I=e=>e.cloneNode(!0),_=(e,t,n)=>{const i=n&&n.nextSibling?n.nextSibling:null;return e.insertBefore(t,i)},j=(e,t)=>{let n=e;if("string"!=typeof t)return n;const i=t.split(".");return i.length>1&&(i[0]===l?n=e[l]||e:i[0]===c&&(n=e[c]||e)),n},V=(e,t)=>{if(e&&w(t))return t.map(t=>((t=t.trim())===s?t=e[s]:t===c?t=e[c]||e:t===l&&(t=e[l]||e),t))},L=e=>{if(e&&e.firstChild)for(;e.firstChild;)e.removeChild(e.firstChild);return e},F=(e=null,t="")=>{const n=e&&e.message?e.message:t;"function"!=typeof console.error?console.log(n):console.error(n)};let H;const W=(e,t)=>{let n=!0;for(e=e.firstElementChild;e;)n=t(e),n&&W(e,t),e=e.nextElementSibling},z=e=>"SVG"===e.tagName,J=(e,t)=>"SVG"===e.tagName||e.hasAttribute(t.comp),G=({node:e,attrObj:t,bindingCache:n,type:i})=>{let r,o;if(H&&H[i]&&void 0!==t[i]){n[i]=n[i]||[],r=t[i]||"",r&&(r=r.replace(v.LINE_BREAKS_TABS,"").replace(v.WHITE_SPACES," ").trim()),o={el:e,dataKey:r},o=(e=>{if(!e||!e.dataKey||e.dataKey.length>h)return e;const t=e.dataKey.split(v.PIPE);let n;return e.dataKey=t[0].trim(),t.length>1&&(t.shift(),t.forEach((i,r)=>{t[r]=i.trim(),t[r]===m.ONCE&&(e.isOnce=!0,n=r)}),void 0!==n&&n>=0&&t.splice(n,1),e.filters=t),e})(o);const a=(e=>{if(!e||e.length>h)return;const t=e.match(v.FUNCTION_PARAM);if(t&&t[1]){const e=t[1].split(",");return e.forEach((t,n)=>{e[n]=t.trim()}),e}})(o.dataKey);a&&(o.parameters=a,o.dataKey=o.dataKey.replace(v.FUNCTION_PARAM,"").trim()),o[g]=n[i],n[i].push(o)}return n},Q=({rootNode:e=null,bindingAttrs:t={},skipCheck:n,isRenderedTemplate:i=!1})=>{let r={};if(!(e instanceof window.Node))throw new TypeError("walkDOM: Expected a DOM node");var o;H=H||(o=t,Object.keys(o).reduce((e,t)=>{const n=o[t];return"string"==typeof n&&M(n)&&(e[n]=t),e},{}));const a=(e,o=J)=>{let a=!1;if(1!==e.nodeType||!e.hasAttributes())return!0;if(o(e,t)||"function"==typeof n&&n(e))return!1;const l=(e=>{const t={};return Array.prototype.slice.call(e.attributes).forEach(e=>{t[e.name]=e.value}),t})(e),c=((e={},t)=>[t.forOf,t.if,t.case,t.default].filter(t=>void 0!==e[t]))(l,t);let s=[];if(c.length)a=!0,s=c;else{if(i&&l[t.tmp])return!0;s=Object.keys(l)}return s.forEach(n=>{n!==t.case&&n!==t.default&&(r=G({node:e,attrObj:l,bindingCache:r,type:n}))}),!a};return a(e,z)&&W(e,a),r};function q(e="",t={}){const n={templateBinding:!1,textBinding:!0,cssBinding:!0,ifBinding:!0,showBinding:!0,modelBinding:!0,attrBinding:!0,forOfBinding:!0,switchBinding:!0},i={changeBinding:!0,clickBinding:!0,dblclickBinding:!0,blurBinding:!0,focusBinding:!0,hoverBinding:!0,inputBinding:!0,submitBinding:!0},r={templateBinding:!1,textBinding:!1,cssBinding:!1,ifBinding:!1,showBinding:!1,modelBinding:!1,attrBinding:!1,forOfBinding:!1,switchBinding:!1};let o={};switch(e){case f:o=k(!1,{},i,r,t);break;case p:t.templateBinding=!0,t.forceRender=!0,o=k(!1,{},n,i,t);break;default:o=k(!1,{},n,t)}return o}const U=/[&<>"'`]/g,Z=RegExp(U.source),X={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"};function Y(e){return X[e]}function ee(e,t,n,i,r){let o="",a="";return function(l){const c=this,s="checkbox"===c.type;var d,u;a=s?c.checked:(d=c.value,(d="string"==typeof(u=d)?u:null==u?"":`${u}`)&&Z.test(d)?d.replace(U,Y):d),t&&(o=S(e,t),D(e,t,a));const f=[l,l.currentTarget,a,o].concat(n);i.apply(r,f),o=a}}const te=({cache:e,viewModel:t,bindingAttrs:n,forceRender:i,type:r="change"})=>{var o;const a=e.dataKey;let l=e.parameters;const c=e.el.getAttribute(n.model);let s;const d=t.APP||(null===(o=t.$root)||void 0===o?void 0:o.APP),u=null==d?void 0:d.$rootElement;if(!a||!i&&u&&!u.contains(e.el))return;const f=S(t,a);if("function"==typeof f){s=j(t,a),l=l?V(t,l):[];const n=ee(t,c,l,f,s);e.el.removeEventListener(r,n,!1),e.el.addEventListener(r,n,!1)}},ne=(e={},t,n,i)=>{if(!e.dataKey)return;const r=((e="")=>v.OBJECT_LITERAL.test(e))(e.dataKey),o=r?((e="")=>{let t=e.trim();const n={};return v.OBJECT_LITERAL.test(e)?(t=t.replace(v.LINE_BREAKS_TABS,"").substring(1),t=t.substring(0,t.length-1),t.split(",").forEach(e=>{const t=e.trim();if(t){const e=t.split(":"),i=e[0].trim();n[i]=`${e[1]}`.trim()}}),n):null})(e.dataKey):T(t,e);if(!P(o))return;if(e.elementData=e.elementData||{},e.elementData.viewModelPropValue=e.elementData.viewModelPropValue||{},JSON.stringify(e.elementData.viewModelPropValue)===JSON.stringify(o))return;r&&$(o,(e,n)=>{o[e]=T(t,{dataKey:n})});const a=e.elementData.viewModelPropValue;B(a)?$(o,(t,n)=>{void 0!==n&&(e.el.setAttribute(t,n),r||(e.elementData.viewModelPropValue[t]=n))}):($(a,(t,n)=>{void 0===o[t]&&e.el.removeAttribute(t)}),$(o,(t,n)=>{void 0!==n&&a[t]!==o[t]&&(e.el.setAttribute(t,o[t]),r||(e.elementData.viewModelPropValue[t]=n))})),r&&(e.elementData.viewModelPropValue=k(!1,{},o))};let ie=null,re=null,oe=!1,ae=!1,le=0;const ce=(e,t,n,i)=>{const r="string"==typeof e.dataKey?(e=>{const t=e.replace(/(\s*?{\s*?|\s*?,\s*?)(['"])?([a-zA-Z0-9]+)(['"])?:/g,'$1"$3":').replace(/'/g,'"');return JSON.parse(t)})(e.dataKey):e.dataKey;let o=r.data;const a=r.append,l=r.prepend;let c;if(e.dataKey=r,o=void 0===o||"$root"===o?t:T(t,{dataKey:r.data,parameters:e.parameters}),!o)return;const s=e.el,d=void 0!==t.$index?t.$index:s.getAttribute("data-index");void 0!==d&&(o.$index=d),ie=ie||document.createDocumentFragment(),re||(re=s,oe=l,ae=a);const u=O((e=>{const t=document.getElementById(e);return t?t.innerHTML:""})(r.id));ie.childNodes.length?(c=s,a||l||(c=L(c)),l?c.insertBefore(u,c.firstChild):c.appendChild(u)):(c=ie,ie.appendChild(u));const f=c.querySelectorAll(`[${n.tmp}]`),p=f.length;if(p){le+=p;for(let e=0;e<p;e+=1){const r={el:f[e],dataKey:f[e].getAttribute(n.tmp)};i[n.tmp].push(r),ce(r,t,n,i),le-=1}}0===le&&(ae||oe||(re=L(re)),oe?re.insertBefore(ie,re.firstChild):re.appendChild(ie),ie=re=null,oe=ae=!1,"function"==typeof t.afterTemplateRender&&t.afterTemplateRender(o))},se=({ctx:e,elementCache:t,updateOption:n,bindingAttrs:i,viewModel:r})=>{if(!t||!i)return!1;if(t[i.tmp]&&t[i.tmp].length){n.templateBinding&&(n=q(p),t[i.tmp].forEach(e=>{ce(e,r,i,t)}),e.updateElementCache({templateCache:!0,elementCache:t,isRenderedTemplates:!0})),n.forceRender=!0;for(let o=0;o<t[i.tmp].length;o++)Se({ctx:e,elementCache:t[i.tmp][o].bindingCache,updateOption:n,bindingAttrs:i,viewModel:r})}return!0},de=({elementCache:e,iterationVm:t,bindingAttrs:n,isRegenerate:i})=>{const r=i?q(p):q();r.forceRender=!0,se({ctx:t.$root?t.$root.APP:t.APP,elementCache:e,updateOption:r,bindingAttrs:n,viewModel:t}),Se({ctx:t.$root?t.$root.APP:t.APP,elementCache:e,updateOption:r,bindingAttrs:n,viewModel:t})},ue=e=>{const t=e.el.cloneNode(!0);return e.fragment=document.createDocumentFragment(),e.fragment.appendChild(t),e},fe=t=>{if(!t||!t.type)return t;let a="";const l=t.dataKey?t.dataKey.replace(v.WHITE_SPACES,"_"):"";switch(t.type){case e.forOf:a=n;break;case e.if:a=i;break;case e.case:a=r;break;case e.default:a=o}return t.commentPrefix=a+l,t},pe=(e,t)=>{t.commentPrefix||fe(t);const n=t.commentPrefix+a;if(e=e.nextSibling){if(8===e.nodeType&&e.textContent===n)return t.docRange.setEndBefore(e);pe(e,t)}},he=(e,t)=>{let n="";e.commentPrefix||fe(e),n=e.commentPrefix;const i=document.createComment(n),r=document.createComment(n+a);return 11===t.nodeType?(t.insertBefore(i,t.firstChild),t.appendChild(r)):t.parentNode&&(t.parentNode.insertBefore(i,t),_(t.parentNode,r,t),e.previousNonTemplateElement=t.previousSibling,e.nextNonTemplateElement=t.nextSibling,e.parentElement=t.previousSibling.parentElement),t},me=e=>{e.docRange||(e.docRange=document.createRange());try{e.previousNonTemplateElement?(e.docRange.setStartBefore(e.previousNonTemplateElement.nextSibling),pe(e.previousNonTemplateElement.nextSibling,e)):(e.docRange.setStartBefore(e.parentElement.firstChild),pe(e.parentElement.firstChild,e))}catch(e){console.log("error removeElemnetsByCommentWrap: ",e.message)}return e.docRange.deleteContents()},ge=(e,t)=>{e.previousNonTemplateElement?_(e.parentElement,t,e.previousNonTemplateElement):e.nextNonTemplateElement?e.parentElement.insertBefore(t,e.nextNonTemplateElement):e.parentElement&&e.parentElement.appendChild(t)},be=({bindingData:e,viewModel:t,iterationData:n,keys:i,index:r})=>{const o={};return o[e.iterator.alias]=i?n[i[r]]:n[r],o[l]=t.$root||t,o[c]=o[e.iterator.alias],o[s]=r,o},ye=(e,t,n,i,r)=>{const o=document.createDocumentFragment(),a=e.iterationSize;let l,c,s,d=0;for(w(e.iterationBindingCache)?e.iterationBindingCache.length=0:e.iterationBindingCache=[],d=0;d<a;d+=1)l=I(e.el),s=Q({rootNode:l,bindingAttrs:n}),e.iterationBindingCache.push(s),B(s)||(c=be({bindingData:e,viewModel:t,iterationData:i,keys:r,index:d}),de({elementCache:e.iterationBindingCache[d],iterationVm:c,bindingAttrs:n,isRegenerate:!0})),o.appendChild(l);return o},ve=(t,n,i,r)=>{const o=t.dataKey;if(o&&!(o.length>h)){if(!t.iterator){if(o.length>h)return;t.dataKey=t.dataKey.replace(v.WHITE_SPACES," ");const e=o.match(v.FOR_OF);if(!e)return;t.iterator={},t.iterator.alias=e[1].trim(),e[2]&&(t.iterator.dataKey=e[2].trim(),t.parentElement=t.el.parentElement,t.previousNonTemplateElement=t.el.previousSibling,t.nextNonTemplateElement=t.el.nextSibling)}(({bindingData:t,viewModel:n,bindingAttrs:i})=>{if(!t||!n||!i)return;let r,o;const a=T(n,t.iterator);let l=!1;if(w(a))o=a.length;else{if(!P(a))return F(null,"iterationData is not an plain object or array");r=Object.keys(a),o=r.length}if(t.type||(t.type=e.forOf,he(t,t.el)),void 0===t.iterationSize?(t.iterationSize=o,t.el.removeAttribute(i.forOf),l=!0):(l=t.iterationSize!==o,t.iterationSize=o),!l)return void t.iterationBindingCache.forEach((e,o)=>{if(!B(e)){const l=be({bindingData:t,viewModel:n,iterationData:a,keys:r,index:o});de({elementCache:e,iterationVm:l,bindingAttrs:i,isRegenerate:!1})}});const c=ye(t,n,i,a,r);me(t),ge(t,c)})({bindingData:t,viewModel:n,bindingAttrs:i})}},Ee=e=>{me(e),e.hasIterationBindingCache&&(delete e.iterationBindingCache,delete e.hasIterationBindingCache)},Ae=({bindingData:e,viewModel:t,bindingAttrs:n})=>{if(!e.fragment)return;const i=(e=>{let t=!1;if(e&&e.previousNonTemplateElement){const n=e.previousNonTemplateElement.textContent,i=e.previousNonTemplateElement.nextSibling;i&&8===i.nodeType&&i.textContent===n+a&&(t=!0)}return t})(e);let r=e.el;if(!i&&!e.isOnce){Ee(e);const t=e.fragment.firstChild;t&&(r=t.cloneNode(!0))}e.iterationBindingCache&&e.hasIterationBindingCache||(e.iterationBindingCache=Q({rootNode:r,bindingAttrs:n})),B(e.iterationBindingCache)||(e.hasIterationBindingCache=!0,de({elementCache:e.iterationBindingCache,iterationVm:t,bindingAttrs:n,isRegenerate:!0})),ge(e,r)},we=(t,n,i,r)=>{if(!t.dataKey||t.isOnce&&!1===t.hasIterationBindingCache)return;t.elementData=t.elementData||{},t.type=t.type||e.if;const o=t.elementData.viewModelPropValue,a=T(n,t)||!1;if(o===a&&!t.hasIterationBindingCache)return;const l=Boolean(a);if(!l&&t.isOnce&&t.el.parentNode)return(c=t.el)&&c.parentNode&&c.parentNode.removeChild(c),void Ce({viewModel:n,cache:t});var c;t.elementData.viewModelPropValue=a,t.fragment||(he(t,t.el),t.el.removeAttribute(i.if),ue(t)),l?(Ae({bindingData:t,viewModel:n,bindingAttrs:i}),t.isOnce&&!t.hasIterationBindingCache&&Ce({viewModel:n,cache:t})):Ee(t)},Ce=({viewModel:e,cache:t})=>{var n;let i=!1;if(null===(n=e.APP)||void 0===n?void 0:n.postProcessQueue){const n=t[g];e.APP.postProcessQueue.push(((e,t)=>()=>{n.splice(t,1)})(0,n.indexOf(t))),i=!0}return i},Pe=(e,t,n,i)=>{if(!e.dataKey)return;e.elementData=e.elementData||{};const r=T(t,e);if(r!==e.elementData.viewModelPropValue){if(e.elementData.viewModelPropValue=r,!e.cases){const t=e.el.children;if(!t.length)return;e.cases=[];for(let i=0,r=t.length;i<r;i+=1){let r=null;const o=t[i];o.hasAttribute(n.case)?r=Oe(o,n.case):o.hasAttribute(n.default)&&(r=Oe(o,n.default),r.isDefault=!0),r&&(he(r,r.el),r.isDefault?r.el.removeAttribute(n.default):r.el.removeAttribute(n.case),ue(r),e.cases.push(r))}}if(e.cases.length){let i=!1;for(let r=0,o=e.cases.length;r<o;r+=1){let o;if(e.cases[r].dataKey&&(o=T(t,e.cases[r])||e.cases[r].dataKey),o===e.elementData.viewModelPropValue||e.cases[r].isDefault){i=!0,Ae({bindingData:e.cases[r],viewModel:t,bindingAttrs:n}),Be(e.cases,r);break}}i||Be(e.cases)}}};function Be(e,t){e.forEach((e,n)=>{n===t&&void 0!==t||(Ee(e),e.hasIterationBindingCache&&(e.iterationBindingCache=null,e.hasIterationBindingCache=!1))})}function Oe(e,t){return{el:e,dataKey:e.getAttribute(t),type:t}}function Re(e,t,n,i){return function(r){let o,a=[];"submit"===e?(o=(e=>{const t={};return e instanceof HTMLFormElement?(new FormData(e).forEach((e,n)=>{Object.prototype.hasOwnProperty.call(Object,n)?(Array.isArray(t[n])||(t[n]=[t[n]]),t[n].push(e)):t[n]=e}),t):t})(r.currentTarget),a=[r,r.currentTarget,o].concat(t)):a=[r,r.currentTarget].concat(t),n.apply(i,a)}}const Me=({cache:e={},forceRender:t=!1,type:n="",viewModel:i={}})=>{var r;const o=e.dataKey;let a,l=e.parameters;const c=i.APP||(null===(r=i.$root)||void 0===r?void 0:r.APP),s=null==c?void 0:c.$rootElement;if(!n||!o||!t&&s&&!s.contains(e.el))return;const d=S(i,o);if("function"==typeof d){a=j(i,o),l=l?V(i,l):[];const t=Re(n,l,d,a);e.el.removeEventListener(n,t,!1),e.el.addEventListener(n,t,!1)}};function Se({ctx:e,elementCache:t,updateOption:n,bindingAttrs:i,viewModel:r}){t&&n&&(n.forOfBinding&&t[i.forOf]&&t[i.forOf].length&&t[i.forOf].forEach(e=>{ve(e,r,i,n.forceRender)}),n.attrBinding&&t[i.attr]&&t[i.attr].length&&t[i.attr].forEach(e=>{ne(e,r,0,n.forceRender)}),n.ifBinding&&t[i.if]&&t[i.if].length&&t[i.if].forEach(e=>{we(e,r,i,n.forceRender)}),n.showBinding&&t[i.show]&&t[i.show].length&&t[i.show].forEach(e=>{((e,t)=>{let n={},i="",r=!0;if(!e.dataKey)return;e.elementData=e.elementData||{};const o=e.elementData.viewModelPropValue;if(void 0===e.elementData.displayStyle||void 0===e.elementData.computedStyle)if(n=e.el.style,i=n.display,i)e.elementData.displayStyle="none"===i?"block":i,e.elementData.computedStyle=null;else{const t=window.getComputedStyle(e.el,null).getPropertyValue("display");e.elementData.displayStyle=null,e.elementData.computedStyle=t}r=T(t,e),r=Boolean(r),o!==r&&(r?e.elementData.computedStyle||"none"===e.el.style.display?"none"===e.elementData.computedStyle?e.el.style.setProperty("display","block"):n.length>1?e.el.style.removeProperty("display"):e.el.removeAttribute("style"):e.el.style.setProperty("display",e.elementData.displayStyle):"none"!==e.el.style.display&&e.el.style.setProperty("display","none"),e.elementData.viewModelPropValue=r)})(e,r,0,n.forceRender)}),n.switchBinding&&t[i.switch]&&t[i.switch].length&&t[i.switch].forEach(e=>{Pe(e,r,i,n.forceRender)}),n.textBinding&&t[i.text]&&t[i.text].length&&t[i.text].forEach(e=>{((e,t,n,i)=>{const r=e.dataKey,o=t.APP||t.$root.APP;if(!r||!i&&!o.$rootElement.contains(e.el))return;const a=T(t,e),l=e.el.textContent;void 0!==a&&"object"!=typeof a&&null!==a&&a!==l&&(e.el.textContent=a)})(e,r,0,n.forceRender)}),n.cssBinding&&t[i.css]&&t[i.css].length&&t[i.css].forEach(e=>{((e,t,n,i)=>{const r=e.dataKey,o=t.APP||t.$root.APP;if(!r||!i&&!o.$rootElement.contains(e.el))return;e.elementData=e.elementData||{},e.elementData.viewModelPropValue=e.elementData.viewModelPropValue||"";const a=e.elementData.viewModelPropValue;let l="";const c=T(t,e);let s=[],d=!1,u=!1,f=[];if("string"==typeof c)u=!0;else{if(!P(c))return;d=!0}if(d?l=JSON.stringify(c):(l=c.replace(/\s\s+/g," ").trim(),s=l.split(" ")),a===l)return;const p=e.el.classList,h=p.length;for(let e=0;e<h;e+=1)f.push(p[e]);var m;d?$(c,(e,t)=>{const n=f.indexOf(e);!0===t?f.push(e):-1!==n&&f.splice(n,1)}):u&&(m=a,f=f.filter((e,t)=>m.indexOf(e)<0),f=f.concat(s)),f=f.filter((e,t,n)=>n.indexOf(e)===t);const g=f.join(" ");e.elementData.viewModelPropValue=l,e.el.setAttribute("class",g)})(e,r,0,n.forceRender)}),n.modelBinding&&t[i.model]&&t[i.model].length&&t[i.model].forEach(e=>{((e,t,n,i)=>{const r=e.dataKey;let o="";const a=t.APP||t.$root.APP;if(r&&(i||a.$rootElement.contains(e.el))&&(o=S(t,r),null!=o)){const t=e.el,n="checkbox"===t.type,i="radio"===t.type,r=t.name,l=i?a.$rootElement.querySelectorAll(`input[name="${r}"]`):[];if(o!==(n?t.checked:t.value))if(n)t.checked=Boolean(o);else if(i){let e=0;const t=l.length;for(e=0;e<t;e+=1)if(l[e].value===o){l[e].checked=!0;break}}else t.value=o}})(e,r,0,n.forceRender)}),n.changeBinding&&t[i.change]&&t[i.change].length&&t[i.change].forEach(e=>{te({bindingAttrs:i,cache:e,forceRender:n.forceRender,type:"change",viewModel:r})}),n.submitBinding&&t[i.submit]&&t[i.submit].length&&t[i.submit].forEach(e=>{Me({cache:e,forceRender:n.forceRender,type:"submit",viewModel:r})}),n.clickBinding&&t[i.click]&&t[i.click].length&&t[i.click].forEach(e=>{Me({cache:e,forceRender:n.forceRender,type:"click",viewModel:r})}),n.dblclickBinding&&t[i.dblclick]&&t[i.dblclick].length&&t[i.dblclick].forEach(e=>{Me({cache:e,forceRender:n.forceRender,type:"dblclick",viewModel:r})}),n.blurBinding&&t[i.blur]&&t[i.blur].length&&t[i.blur].forEach(e=>{Me({cache:e,forceRender:n.forceRender,type:"blur",viewModel:r})}),n.focusBinding&&t[i.focus]&&t[i.focus].length&&t[i.focus].forEach(e=>{Me({cache:e,forceRender:n.forceRender,type:"focus",viewModel:r})}),n.hoverBinding&&t[i.hover]&&t[i.hover].length&&t[i.hover].forEach(e=>{((e,t,n,i)=>{var r;const o=e.dataKey;let a=e.parameters;const l=d,c=u;let s;const f=t.APP||(null===(r=t.$root)||void 0===r?void 0:r.APP);e.elementData=e.elementData||{};const p=null==f?void 0:f.$rootElement;if(!o||!i&&p&&!p.contains(e.el))return;const h=S(t,o);if(h&&"function"==typeof h[l]&&"function"==typeof h[c]){s=j(t,o),a=a?V(t,a):[];const n=function(e,t,n,i,r){return function(o){const a=[o,e.el].concat(r);t[n].apply(i,a)}}(e,h,l,s,a),i=function(e,t,n,i,r){return function(o){const a=[o,e.el].concat(r);t[n].apply(i,a)}}(e,h,c,s,a);e.el.removeEventListener("mouseenter",n,!1),e.el.removeEventListener("mouseleave",i,!1),e.el.addEventListener("mouseenter",n,!1),e.el.addEventListener("mouseleave",i,!1)}})(e,r,0,n.forceRender)}),n.inputBinding&&t[i.input]&&t[i.input].length&&t[i.input].forEach(e=>{te({bindingAttrs:i,cache:e,forceRender:n.forceRender,type:"input",viewModel:r})}))}const De={},Te=(e=null,t="",n,i=!1)=>{if(!e||!e.compId||!t||"function"!=typeof n)return;let r,o=!1;t=t.replace(v.WHITE_SPACES,""),De[t]=De[t]||[],o=De[t].some(t=>!!t[e.compId]&&(t[e.compId]=n.bind(e.viewModel),t.isOnce=i,!0)),o||(r={},r[e.compId]=n.bind(e.viewModel),r.isOnce=i,De[t].push(r))},xe=(e="",t="")=>{if(!e||!t)return;let n,i=0,r=0;if(t=t.replace(v.WHITE_SPACES,""),De[t])for(r=De[t].length,i=0;i<r;i+=1)if(n=De[t][i],n[e]){De[t].splice(i,1);break}De[t]&&!De[t].length&&delete De[t]};let Ne=0;class ke{constructor(e,n,i){if(!e||1!==e.nodeType||null===n||"object"!=typeof n)throw new TypeError("$rootElement or viewModel is invalid");return this.initRendered=!1,this.compId=Ne+=1,this.$rootElement=e,this.viewModel=n,this.bindingAttrs=i,this.isServerRendered=null!==this.$rootElement.getAttribute(t),this.render=((e,t=null)=>function(e,t){let n=N(),i=0;return function(){const r=Array.from?Array.from(arguments):Array.prototype.slice.call(arguments);return window.cancelAnimationFrame(i),i=window.requestAnimationFrame(()=>{try{e.apply(t,r),n.resolve(t)}catch(e){console.error("error in rendering: ",e),n.reject(e)}n=N(),window.cancelAnimationFrame(i)}),n.promise}}(e,t))(this._render.bind(this),this),this.viewModel.APP=this,this.viewModel.$root=this.viewModel,this.parseView(),this.$rootElement[l]=this.viewModel,this}parseView(){return this.elementCache=Q({rootNode:this.$rootElement,bindingAttrs:this.bindingAttrs}),this.isServerRendered&&!this.initRendered&&this.updateElementCache({templateCache:!0}),this}updateElementCache(e={}){const t=e.elementCache||this.elementCache;if(e.allCache&&(this.elementCache=Q({rootNode:this.$rootElement,bindingAttrs:this.bindingAttrs})),(e.allCache||e.templateCache)&&t[this.bindingAttrs.tmp]&&t[this.bindingAttrs.tmp].length)for(let n=0;n<t[this.bindingAttrs.tmp].length;n++){const i=t[this.bindingAttrs.tmp][n];let r=null;i.el.hasAttribute(this.bindingAttrs.forOf)&&(r=()=>!0),i.bindingCache=Q({rootNode:i.el,bindingAttrs:this.bindingAttrs,skipCheck:r,isRenderedTemplate:e.isRenderedTemplates})}}_render(e={}){let n={};this.initRendered?n=q("",e):this.isServerRendered?(this.$rootElement.removeAttribute(t),n=q(f,e)):n=q(p,e),this.postProcessQueue=[];const i={ctx:this,elementCache:this.elementCache,updateOption:n,bindingAttrs:this.bindingAttrs,viewModel:this.viewModel};var r;se(i),Se(i),(r=this.postProcessQueue)&&r.length&&$(r,(e,t)=>{if("function"==typeof t)try{t()}catch(e){F(e,`Error postProcess: ${String(t)}`)}}),this.postProcessQueue.length=0,delete this.postProcessQueue,this.initRendered=!0}subscribe(e="",t){return Te(this,e,t),this}subscribeOnce(e="",t){return((e=null,t="",n)=>{Te(e,t,n,!0)})(this,e,t),this}unsubscribe(e=""){return xe(this.compId,e),this}unsubscribeAll(){return((e="")=>{e&&Object.keys(De).forEach(t=>{xe(e,t)})})(this.compId),this}publish(e="",...t){return((e="",...t)=>{e&&De[e]&&(e=e.replace(v.WHITE_SPACES,""),De[e].forEach(n=>{Object.keys(n).forEach(i=>{if("function"==typeof n[i]){const r=n[i](...t);return n.isOnce&&xe(i,e),r}})}))})(e,...t),this}}const $e="function"==typeof window.Promise;let Ke=e;return{use:(e={})=>{e.bindingAttrs&&(Ke=k(!1,{},e.bindingAttrs))},init:(e,t=null)=>$e?new ke(e,t,Ke):console.warn("Browser not support Promise"),version:"@version@"}});
//# sourceMappingURL=dataBind.min.js.map
