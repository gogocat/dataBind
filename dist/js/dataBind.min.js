/* @gogocat/data-bind | version 1.12.0 | By Adam Chow | link https://gogocat.github.io/dataBind/ | license MIT */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).dataBind=t()}(this,function(){"use strict";const e={comp:"data-bind-comp",tmp:"data-bind-tmp",text:"data-bind-text",click:"data-bind-click",dblclick:"data-bind-dblclick",blur:"data-bind-blur",focus:"data-bind-focus",hover:"data-bind-hover",input:"data-bind-input",change:"data-bind-change",submit:"data-bind-submit",model:"data-bind-model",show:"data-bind-show",css:"data-bind-css",attr:"data-bind-attr",forOf:"data-bind-for",if:"data-bind-if",switch:"data-bind-switch",case:"data-bind-case",default:"data-bind-default"},t="data-server-rendered",n="data-forOf_",r="data-if_",i="data-case_",o="data-default_",a="_end",l="$root",s="$data",c="$index",d="in",u="out",f="SERVER-RENDERED",p="INIT",h=250,m={ONCE:"once"},g="_parent";function y(){return y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)({}).hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},y.apply(null,arguments)}const b=Array.isArray,v={BAD_TAGS:/<(script|del)(?=[\s>])[\w\W]*?<\/\1\s*>/gi,FOR_OF:/(.*?)\s+(?:in|of)\s+(.*)/,FUNCTION_PARAM:/\((.*?)\)/,HTML_TAG:/^[\s]*<([a-z][^\/\s>]+)/i,OBJECT_LITERAL:/^\{.+\}$/,PIPE:/\|/,WHITE_SPACES:/\s+/g,LINE_BREAKS_TABS:/(\r\n|\n|\r|\t)/gm},A="content"in document.createElement("template"),E={div:["div","<div>","</div>"],thead:["table","<table>","</table>"],col:["colgroup","<table><colgroup>","</colgroup></table>"],tr:["tbody","<table><tbody>","</tbody></table>"],td:["tr","<table><tr>","</tr></table>"]};E.caption=E.colgroup=E.tbody=E.tfoot=E.thead,E.th=E.td;const C=e=>b?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e),w=e=>null!==e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e),P=e=>{if(!w(e))return!1;const t=e.constructor;if("function"!=typeof t)return!1;const n=t.prototype;return!1!==w(n)&&!1!==n.hasOwnProperty("isPrototypeOf")},B=e=>!!w(e)&&0===Object.getOwnPropertyNames(e).length,S=e=>{if("string"!=typeof e)return null;if(A){const t=document.createElement("template");return t.innerHTML=((e="")=>e.replace(v.BAD_TAGS,""))(e),t.content}const t=document.createDocumentFragment(),n=document.createElement("div"),r=(e=>{const t=e.match(v.HTML_TAG);return t?t[1]:null})(e),i=E[r||"div"];if("div"===i[0])return document.createRange().createContextualFragment(e);n.insertAdjacentHTML("beforeend",`${i[1]}${e}${i[2]}`);const o=n.querySelector(i[0]);for(;o&&o.firstChild;)t.appendChild(o.firstChild);return t},R=["__proto__","constructor","prototype"],O=e=>!R.includes(e),T=(e,t)=>((e,t,n)=>{const r=t.replace(/\[/g,".").replace(/]/g,"").split(".").filter(Boolean);let i=e;for(const e of r){if(!e||!O(e))return n;if(null==i)return n;if(i=i[e],void 0===i)return n}return i})(e,t),M=(e,t,n)=>((e,t,n)=>{if(Object(e)!==e)return e;let r;r=Array.isArray(t)?t:t.toString().match(/[^.[\]]+/g)||[];for(const t of r)if(!O(t))return console.warn(`Blocked attempt to set dangerous property: ${t}`),e;const i=r[r.length-1],o=r.slice(0,-1).reduce((e,t,n)=>{if(!O(t))return e;if(Object(e[t])===e[t])return e[t];const i=r[n+1];return e[t]=(0|Math.abs(Number(i)))===+i?[]:{},e[t]},e);return O(i)&&(o[i]=n),e})(e,t,n),D=(e,t)=>{let n=t.dataKey,r=t.parameters;const i=n&&"!"===n.charAt(0);i&&n&&(n=i?n.substring(1):n);let o=n?T(e,n):void 0;if("function"==typeof o){const i=K(e,n||""),a=t.elementData?t.elementData.viewModelPropValue:null;r=r?V(e,r):[];const l=r.concat([a,t.el]);o=o.apply(i,l)}return o=i?!o:o,o=k({value:o,viewModel:e,bindingCache:t}),o},k=({value:e,viewModel:t,bindingCache:n})=>{let r=e;return n.filters&&N(n.filters,(e,n)=>{const i=K(t,n),o=T.call(i,i,n);try{r=o.call(i,r)}catch(e){J(e,`Invalid filter: ${n}`)}}),r},x=()=>{const e={};return e.promise=new Promise((t,n)=>{e.resolve=t,e.reject=n}),e},$=(e=!1,t,...n)=>{if(!n.length)return t||{};const r=n.shift();return void 0===r?t||{}:e?(_(t)&&_(r)&&Object.keys(r).forEach(e=>{_(r[e])?(t[e]||(t[e]={}),$(!0,t[e],r[e])):t[e]=r[e]}),$(!0,t,...n)):y(t||{},r,...n)},N=(e,t)=>{if("object"!=typeof e||"function"!=typeof t)return;let n=[],r=0;const i=C(e);let o,a,l=0;if(i)r=e.length;else{if(!w(e))throw new TypeError("Object is not an array or object");n=Object.keys(e),r=n.length}for(l=0;l<r;l+=1)i?(o=l,a=e[l]):(o=n[l],a=e[o]),t(o,a)},_=e=>w(e)&&!C(e),j=e=>e.cloneNode(!0),I=(e,t,n)=>{const r=n&&n.nextSibling?n.nextSibling:null;return e.insertBefore(t,r)},K=(e,t)=>{let n=e;if("string"!=typeof t)return n;const r=t.split(".");return r.length>1&&(r[0]===l?n=e[l]||e:r[0]===s&&(n=e[s]||e)),n},V=(e,t)=>{if(e&&C(t))return t.map(t=>{let n=t;return"string"==typeof t&&(n=t.trim(),n===c?n=e[c]:n===s?n=e[s]||e:n===l&&(n=e[l]||e)),n})},L=e=>{if(e&&e.firstChild)for(;e.firstChild;)e.removeChild(e.firstChild);return e},F=(e,t)=>{if(e.nodeType!==t.nodeType)return!1;if(3===e.nodeType)return e.nodeValue===t.nodeValue;if(1===e.nodeType){const n=t;return e.tagName===n.tagName}return e.nodeValue===t.nodeValue},H=(e,t)=>{const n=t.attributes,r=n.length;for(let t=0;t<r;t+=1){const r=n[t];if(r&&r.name){e.getAttribute(r.name)!==r.value&&e.setAttribute(r.name,r.value||"")}}},W=e=>{const t=document.createDocumentFragment();return Array.from(e.childNodes).forEach(e=>{t.appendChild(e.cloneNode(!0))}),t},z=(e,t)=>{const n=Array.from(t.childNodes),r=Array.from(e.childNodes),i=n.length,o=r.length;for(let t=0;t<i;t+=1){const i=n[t],o=r[t];o?F(o,i)?1===i.nodeType&&1===o.nodeType?(H(o,i),z(o,W(i))):3===i.nodeType&&o.nodeValue!==i.nodeValue&&(o.nodeValue=i.nodeValue):e.replaceChild(i,o):e.appendChild(i)}for(let t=o-1;t>=i;t-=1)r[t]&&r[t].parentNode&&e.removeChild(r[t])},J=(e=null,t="")=>{const n=e&&"object"==typeof e&&"message"in e?e.message:t;"function"!=typeof console.error?console.log(n):console.error(n)};let q;const G=(e,t)=>{let n=!0,r=e.firstElementChild;for(;r;)n=t(r),n&&G(r,t),r=r.nextElementSibling},Q=e=>"SVG"===e.tagName,U=(e,t)=>"SVG"===e.tagName||e.hasAttribute(t.comp),Z=({node:e,attrObj:t,bindingCache:n,type:r})=>{let i,o;if(q&&q[r]&&void 0!==t[r]){n[r]=n[r]||[],i=t[r]||"",i&&(i=i.replace(v.LINE_BREAKS_TABS,"").replace(v.WHITE_SPACES," ").trim()),o={el:e,dataKey:i},o=(e=>{if(!e||!e.dataKey||e.dataKey.length>h)return e;const t=e.dataKey.split(v.PIPE);let n;return e.dataKey=t[0].trim(),t.length>1&&(t.shift(),t.forEach((r,i)=>{t[i]=r.trim(),t[i]===m.ONCE&&(e.isOnce=!0,n=i)}),void 0!==n&&n>=0&&t.splice(n,1),e.filters=t),e})(o);const a=(e=>{if(!e||e.length>h)return;const t=e.match(v.FUNCTION_PARAM);if(t&&t[1]){const e=t[1].split(",");return e.forEach((t,n)=>{e[n]=t.trim()}),e}})(o.dataKey||"");a&&(o.parameters=a,o.dataKey=(o.dataKey||"").replace(v.FUNCTION_PARAM,"").trim()),o[g]=n[r],n[r].push(o)}return n},X=({rootNode:e=null,bindingAttrs:t={},skipCheck:n,isRenderedTemplate:r=!1})=>{let i={};if(!(e instanceof window.Node))throw new TypeError("walkDOM: Expected a DOM node");var o;q=q||(o=t,Object.keys(o).reduce((e,t)=>{const n=o[t];return"string"==typeof n&&O(n)&&(e[n]=t),e},{}));const a=(e,o=U)=>{let a=!1;if(1!==e.nodeType||!e.hasAttributes())return!0;if(o(e,t)||"function"==typeof n&&n(e))return!1;const l=(e=>{const t={};return Array.prototype.slice.call(e.attributes).forEach(e=>{t[e.name]=e.value}),t})(e),s=((e={},t)=>[t.forOf,t.if,t.case,t.default].filter(t=>void 0!==e[t]))(l,t);let c=[];if(s.length)a=!0,c=s;else{if(r&&l[t.tmp])return!0;c=Object.keys(l)}return c.forEach(n=>{n!==t.case&&n!==t.default&&(i=Z({node:e,attrObj:l,bindingCache:i,type:n}))}),!a};return a(e,Q)&&G(e,a),i},Y=(e="",t={})=>{const n={templateBinding:!1,textBinding:!0,cssBinding:!0,ifBinding:!0,showBinding:!0,modelBinding:!0,attrBinding:!0,forOfBinding:!0,switchBinding:!0},r={changeBinding:!0,clickBinding:!0,dblclickBinding:!0,blurBinding:!0,focusBinding:!0,hoverBinding:!0,inputBinding:!0,submitBinding:!0},i={templateBinding:!1,textBinding:!1,cssBinding:!1,ifBinding:!1,showBinding:!1,modelBinding:!1,attrBinding:!1,forOfBinding:!1,switchBinding:!1};let o={};switch(e){case f:o=$(!1,{},r,i,t);break;case p:t.templateBinding=!0,t.forceRender=!0,o=$(!1,{},n,r,t);break;default:o=$(!1,{},n,t)}return o},ee=/[&<>"'`]/g,te=RegExp(ee.source),ne={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},re=e=>ne[e],ie=(e,t,n,r,i)=>{let o="",a="";return function(l){const s=this,c="checkbox"===s.type;a=c?s.checked:(e=>{const t="string"==typeof(n=e)?n:null==n?"":`${n}`;var n;return t&&te.test(t)?t.replace(ee,re):t})(s.value),t&&(o=T(e,t),M(e,t,a));const d=[l,l.currentTarget,a,o,...n];r.apply(i,d),o=a}},oe=({cache:e,viewModel:t,bindingAttrs:n,forceRender:r,type:i="change"})=>{var o;const a=e.dataKey;let l=e.parameters;const s=e.el.getAttribute(n.model);let c;const d=t.APP||(null===(o=t.$root)||void 0===o?void 0:o.APP),u=null==d?void 0:d.$rootElement;if(!a||!r&&u&&!u.contains(e.el))return;const f=T(t,a);if("function"==typeof f){c=K(t,a),l=l?V(t,l):[];const n=ie(t,s,l,f,c);e.el.removeEventListener(i,n,!1),e.el.addEventListener(i,n,!1)}},ae=(e={},t,n,r)=>{if(!e.dataKey)return;const i=((e="")=>v.OBJECT_LITERAL.test(e))(e.dataKey),o=i?((e="")=>{let t=e.trim();const n={};return v.OBJECT_LITERAL.test(e)?(t=t.replace(v.LINE_BREAKS_TABS,"").substring(1),t=t.substring(0,t.length-1),t.split(",").forEach(e=>{const t=e.trim();if(t){const e=t.split(":"),r=e[0].trim();n[r]=`${e[1]}`.trim()}}),n):null})(e.dataKey):D(t,e);if(!P(o))return;if(e.elementData=e.elementData||{},e.elementData.viewModelPropValue=e.elementData.viewModelPropValue||{},JSON.stringify(e.elementData.viewModelPropValue)===JSON.stringify(o))return;i&&N(o,(n,r)=>{o[n]=D(t,{dataKey:r,el:e.el})});const a=e.elementData.viewModelPropValue;B(a)?N(o,(t,n)=>{void 0!==n&&(e.el.setAttribute(t,String(n)),!i&&e.elementData&&(e.elementData.viewModelPropValue[t]=n))}):(N(a,(t,n)=>{void 0===o[t]&&e.el.removeAttribute(t)}),N(o,(t,n)=>{void 0!==n&&a[t]!==o[t]&&(e.el.setAttribute(t,String(o[t])),!i&&e.elementData&&(e.elementData.viewModelPropValue[t]=n))})),i&&(e.elementData.viewModelPropValue=$(!1,{},o))};let le=null,se=null,ce=!1,de=!1,ue=0;const fe=(e,t,n,r)=>{const i="string"==typeof e.dataKey?(e=>{const t=e.replace(/(\s*?{\s*?|\s*?,\s*?)(['"])?([a-zA-Z0-9]+)(['"])?:/g,'$1"$3":').replace(/'/g,'"');return JSON.parse(t)})(e.dataKey):e.dataKey;let o=i.data;const a=i.append,l=i.prepend;let s;if(e.dataKey=i,o=void 0===o||"$root"===o?t:D(t,{dataKey:i.data,parameters:e.parameters}),!o)return;const c=e.el,d=c.getAttribute("data-index"),u=void 0!==t.$index?t.$index:d?parseInt(d,10):void 0;void 0!==u&&o&&"object"==typeof o&&(o.$index=u),le=le||document.createDocumentFragment(),se||(se=c,ce=Boolean(l),de=Boolean(a));const f=(e=>{const t=document.getElementById(e);return t?t.innerHTML:""})(i.id),p=S(f);if(!p)return;le.childNodes.length?(s=c,a||l||(s=L(s)),l?s.insertBefore(p,s.firstChild):s.appendChild(p)):(s=le,le.appendChild(p));const h=s.querySelectorAll(`[${n.tmp}]`),m=h.length;if(m){ue+=m;for(let e=0;e<m;e+=1){const i={el:h[e],dataKey:h[e].getAttribute(n.tmp)};r[n.tmp].push(i),fe(i,t,n,r),ue-=1}}if(0===ue){if(de||ce)ce?se.insertBefore(le,se.firstChild):se.appendChild(le);else{se.hasAttribute("data-template-rendered")?z(se,le):(se=L(se),se.appendChild(le),se.setAttribute("data-template-rendered","true"))}le=se=null,ce=de=!1,t.afterTemplateRender&&"function"==typeof t.afterTemplateRender&&t.afterTemplateRender(o)}},pe=({ctx:e,elementCache:t,updateOption:n,bindingAttrs:r,viewModel:i})=>{if(!t||!r)return!1;if(t[r.tmp]&&t[r.tmp].length){n.templateBinding&&(n=Y(p),t[r.tmp].forEach(e=>{fe(e,i,r,t)}),e.updateElementCache({templateCache:!0,elementCache:t,isRenderedTemplates:!0})),n.forceRender=!0;for(let o=0;o<t[r.tmp].length;o++)De({ctx:e,elementCache:t[r.tmp][o].bindingCache,updateOption:n,bindingAttrs:r,viewModel:i})}return!0},he=({elementCache:e,iterationVm:t,bindingAttrs:n,isRegenerate:r})=>{const i=r?Y(p):Y();i.forceRender=!0,pe({ctx:t.$root?t.$root.APP:t.APP,elementCache:e,updateOption:i,bindingAttrs:n,viewModel:t}),De({ctx:t.$root?t.$root.APP:t.APP,elementCache:e,updateOption:i,bindingAttrs:n,viewModel:t})},me=e=>{const t=e.el.cloneNode(!0);return e.fragment=document.createDocumentFragment(),e.fragment.appendChild(t),e},ge=t=>{if(!t||!t.type)return t;let a="";const l=t.dataKey?t.dataKey.replace(v.WHITE_SPACES,"_"):"";switch(t.type){case e.forOf:a=n;break;case e.if:a=r;break;case e.case:a=i;break;case e.default:a=o}return t.commentPrefix=a+l,t},ye=(e,t)=>{t.commentPrefix||ge(t);const n=t.commentPrefix+a;if(e=e.nextSibling){if(8===e.nodeType&&e.textContent===n)return t.docRange.setEndBefore(e);ye(e,t)}},be=(e,t)=>{let n="";e.commentPrefix||ge(e),n=e.commentPrefix;const r=document.createComment(n),i=document.createComment(n+a);return 11===t.nodeType?(t.insertBefore(r,t.firstChild),t.appendChild(i)):t.parentNode&&(t.parentNode.insertBefore(r,t),I(t.parentNode,i,t),e.previousNonTemplateElement=t.previousSibling,e.nextNonTemplateElement=t.nextSibling,e.parentElement=t.previousSibling.parentElement),t},ve=e=>{e.docRange||(e.docRange=document.createRange());const t=e.docRange;try{e.previousNonTemplateElement?(t.setStartBefore(e.previousNonTemplateElement.nextSibling),ye(e.previousNonTemplateElement.nextSibling,e)):(t.setStartBefore(e.parentElement.firstChild),ye(e.parentElement.firstChild,e))}catch(e){console.log("error removeElemnetsByCommentWrap: ",e instanceof Error?e.message:String(e))}t.deleteContents()},Ae=(e,t)=>{e.previousNonTemplateElement?I(e.parentElement,t,e.previousNonTemplateElement):e.nextNonTemplateElement?e.parentElement.insertBefore(t,e.nextNonTemplateElement):e.parentElement&&e.parentElement.appendChild(t)},Ee=({bindingData:e,viewModel:t,iterationData:n,keys:r,index:i})=>{var o;const a={},d=null===(o=e.iterator)||void 0===o?void 0:o.alias;return d&&(a[d]=r?n[r[i]]:n[i]),a[l]=t.$root||t,a[s]=d?a[d]:void 0,a[c]=i,a},Ce=(e,t,n,r,i)=>{const o=document.createDocumentFragment(),a=e.iterationSize;let l,s,c,d=0;for(C(e.iterationBindingCache)?e.iterationBindingCache.length=0:e.iterationBindingCache=[],d=0;d<a;d+=1)l=j(e.el),c=X({rootNode:l,bindingAttrs:n}),e.iterationBindingCache.push(c),B(c)||(s=Ee({bindingData:e,viewModel:t,iterationData:r,keys:i,index:d}),he({elementCache:e.iterationBindingCache[d],iterationVm:s,bindingAttrs:n,isRegenerate:!0})),o.appendChild(l);return o},we=(t,n,r,i)=>{const o=t.dataKey;if(o&&!(o.length>h)){if(!t.iterator){if(o.length>h)return;t.dataKey=t.dataKey.replace(v.WHITE_SPACES," ");const e=o.match(v.FOR_OF);if(!e)return;t.iterator={},t.iterator.alias=e[1].trim(),e[2]&&(t.iterator.dataKey=e[2].trim(),t.parentElement=t.el.parentElement,t.previousNonTemplateElement=t.el.previousSibling,t.nextNonTemplateElement=t.el.nextSibling)}(({bindingData:t,viewModel:n,bindingAttrs:r})=>{var i;if(!t||!n||!r)return;let o,a;const l=D(n,t.iterator);let s=!1;if(C(l))a=l.length;else{if(!P(l))return J(null,"iterationData is not an plain object or array");o=Object.keys(l),a=o.length}if(t.type||(t.type=e.forOf,be(t,t.el)),void 0===t.iterationSize?(t.iterationSize=a,t.el.removeAttribute(r.forOf),s=!0):(s=t.iterationSize!==a,t.iterationSize=a),!s)return void(null===(i=t.iterationBindingCache)||void 0===i||i.forEach((e,i)=>{if(!B(e)){const a=Ee({bindingData:t,viewModel:n,iterationData:l,keys:o,index:i});he({elementCache:e,iterationVm:a,bindingAttrs:r,isRegenerate:!1})}}));const c=Ce(t,n,r,l,o);ve(t),Ae(t,c)})({bindingData:t,viewModel:n,bindingAttrs:r})}},Pe=e=>{ve(e),e.hasIterationBindingCache&&(delete e.iterationBindingCache,delete e.hasIterationBindingCache)},Be=({bindingData:e,viewModel:t,bindingAttrs:n})=>{if(!e.fragment)return;const r=(e=>{let t=!1;if(e&&e.previousNonTemplateElement){const n=e.previousNonTemplateElement.textContent,r=e.previousNonTemplateElement.nextSibling;r&&8===r.nodeType&&r.textContent===n+a&&(t=!0)}return t})(e);let i=e.el;if(!r&&!e.isOnce){Pe(e);const t=e.fragment.firstChild;t&&(i=t.cloneNode(!0))}e.iterationBindingCache&&e.hasIterationBindingCache||(e.iterationBindingCache=X({rootNode:i,bindingAttrs:n})),B(e.iterationBindingCache)||(e.hasIterationBindingCache=!0,he({elementCache:e.iterationBindingCache,iterationVm:t,bindingAttrs:n,isRegenerate:!0})),Ae(e,i)},Se=({viewModel:e,cache:t})=>{var n;let r=!1;if(null===(n=e.APP)||void 0===n?void 0:n.postProcessQueue){const n=t[g];e.APP.postProcessQueue.push(((e,t)=>()=>{n.splice(t,1)})(0,n.indexOf(t))),r=!0}return r},Re=(e,t)=>{e.forEach((e,n)=>{n===t&&void 0!==t||(Pe(e),e.hasIterationBindingCache&&(e.iterationBindingCache=null,e.hasIterationBindingCache=!1))})},Oe=(e,t)=>({el:e,dataKey:e.getAttribute(t),type:t}),Te=(e,t,n,r)=>function(i){let o,a=[];"submit"===e?(o=(e=>{const t={};return e instanceof HTMLFormElement?(new FormData(e).forEach((e,n)=>{Object.prototype.hasOwnProperty.call(Object,n)?(Array.isArray(t[n])||(t[n]=[t[n]]),t[n].push(e)):t[n]=e}),t):t})(i.currentTarget),a=[i,i.currentTarget,o,...t]):a=[i,i.currentTarget,...t],n.apply(r,a)},Me=({cache:e={},forceRender:t=!1,type:n="",viewModel:r={}})=>{var i;const o=e.dataKey;let a,l=e.parameters;const s=r.APP||(null===(i=r.$root)||void 0===i?void 0:i.APP),c=null==s?void 0:s.$rootElement;if(!n||!o||!t&&c&&!c.contains(e.el))return;const d=T(r,o);if("function"==typeof d){a=K(r,o),l=l?V(r,l):[];const t=Te(n,l,d,a);e.el.removeEventListener(n,t,!1),e.el.addEventListener(n,t,!1)}},De=({ctx:t,elementCache:n,updateOption:r,bindingAttrs:i,viewModel:o})=>{n&&r&&(r.forOfBinding&&n[i.forOf]&&n[i.forOf].length&&n[i.forOf].forEach(e=>{we(e,o,i,r.forceRender)}),r.attrBinding&&n[i.attr]&&n[i.attr].length&&n[i.attr].forEach(e=>{ae(e,o,0,r.forceRender)}),r.ifBinding&&n[i.if]&&n[i.if].length&&n[i.if].forEach(t=>{((t,n,r)=>{if(!t.dataKey||t.isOnce&&!1===t.hasIterationBindingCache)return;t.elementData=t.elementData||{},t.type=t.type||e.if;const i=t.elementData.viewModelPropValue,o=D(n,t)||!1;if(i===o&&!t.hasIterationBindingCache)return;const a=Boolean(o);if(!a&&t.isOnce&&t.el.parentNode)return(l=t.el)&&l.parentNode&&l.parentNode.removeChild(l),void Se({viewModel:n,cache:t});var l;t.elementData.viewModelPropValue=o,t.fragment||(be(t,t.el),t.el.removeAttribute(r.if),me(t)),a?(Be({bindingData:t,viewModel:n,bindingAttrs:r}),t.isOnce&&!t.hasIterationBindingCache&&Se({viewModel:n,cache:t})):Pe(t)})(t,o,i,r.forceRender)}),r.showBinding&&n[i.show]&&n[i.show].length&&n[i.show].forEach(e=>{((e,t)=>{let n={},r="",i=!0;if(!e.dataKey)return;e.elementData=e.elementData||{};const o=e.elementData.viewModelPropValue;if(void 0===e.elementData.displayStyle||void 0===e.elementData.computedStyle)if(n=e.el.style,r=n.display,r)e.elementData.displayStyle="none"===r?"block":r,e.elementData.computedStyle=null;else{const t=window.getComputedStyle(e.el,null).getPropertyValue("display");e.elementData.displayStyle=null,e.elementData.computedStyle=t}i=D(t,e),i=Boolean(i),o!==i&&(i?e.elementData.computedStyle||"none"===e.el.style.display?"none"===e.elementData.computedStyle?e.el.style.setProperty("display","block"):n.length>1?e.el.style.removeProperty("display"):e.el.removeAttribute("style"):e.el.style.setProperty("display",e.elementData.displayStyle):"none"!==e.el.style.display&&e.el.style.setProperty("display","none"),e.elementData.viewModelPropValue=i)})(e,o,0,r.forceRender)}),r.switchBinding&&n[i.switch]&&n[i.switch].length&&n[i.switch].forEach(e=>{((e,t,n)=>{if(!e.dataKey)return;e.elementData=e.elementData||{};const r=D(t,e);if(r!==e.elementData.viewModelPropValue){if(e.elementData.viewModelPropValue=r,!e.cases){const t=e.el.children;if(!t.length)return;e.cases=[];for(let r=0,i=t.length;r<i;r+=1){let i=null;const o=t[r];o.hasAttribute(n.case)?i=Oe(o,n.case):o.hasAttribute(n.default)&&(i=Oe(o,n.default),i.isDefault=!0),i&&(be(i,i.el),i.isDefault?i.el.removeAttribute(n.default):i.el.removeAttribute(n.case),me(i),e.cases.push(i))}}if(e.cases.length){let r=!1;for(let i=0,o=e.cases.length;i<o;i+=1){let o;if(e.cases[i].dataKey&&(o=D(t,e.cases[i])||e.cases[i].dataKey),o===e.elementData.viewModelPropValue||e.cases[i].isDefault){r=!0,Be({bindingData:e.cases[i],viewModel:t,bindingAttrs:n}),Re(e.cases,i);break}}r||Re(e.cases)}}})(e,o,i,r.forceRender)}),r.textBinding&&n[i.text]&&n[i.text].length&&n[i.text].forEach(e=>{((e,t,n,r)=>{var i,o;const a=e.dataKey,l=t.APP||(null===(i=t.$root)||void 0===i?void 0:i.APP);if(!a||!r&&!(null===(o=null==l?void 0:l.$rootElement)||void 0===o?void 0:o.contains(e.el)))return;const s=D(t,e),c=e.el.textContent;void 0!==s&&"object"!=typeof s&&null!==s&&s!==c&&(e.el.textContent=String(s))})(e,o,0,r.forceRender)}),r.cssBinding&&n[i.css]&&n[i.css].length&&n[i.css].forEach(e=>{((e,t,n,r)=>{var i,o;const a=e.dataKey,l=t.APP||(null===(i=t.$root)||void 0===i?void 0:i.APP);if(!a||!r&&!(null===(o=null==l?void 0:l.$rootElement)||void 0===o?void 0:o.contains(e.el)))return;e.elementData=e.elementData||{},e.elementData.viewModelPropValue=e.elementData.viewModelPropValue||"";const s=e.elementData.viewModelPropValue;let c="";const d=D(t,e);let u=[],f=!1,p=!1,h=[];if("string"==typeof d)p=!0;else{if(!P(d))return;f=!0}if(f?c=JSON.stringify(d):(c=d.replace(/\s\s+/g," ").trim(),u=c.split(" ")),s===c)return;const m=e.el.classList,g=m.length;for(let e=0;e<g;e+=1)h.push(m[e]);if(f)N(d,(e,t)=>{const n=h.indexOf(e);!0===t?h.push(e):-1!==n&&h.splice(n,1)});else if(p){const e="string"==typeof s&&s?s.split(" "):[];y=e,h=h.filter((e,t)=>y.indexOf(e)<0),h=h.concat(u)}var y;h=h.filter((e,t,n)=>n.indexOf(e)===t);const b=h.join(" ");e.elementData.viewModelPropValue=c,e.el.setAttribute("class",b)})(e,o,0,r.forceRender)}),r.modelBinding&&n[i.model]&&n[i.model].length&&n[i.model].forEach(e=>{((e,t,n,r)=>{var i,o;const a=e.dataKey;let l="";const s=t.APP||(null===(i=t.$root)||void 0===i?void 0:i.APP);if(a&&(r||(null===(o=null==s?void 0:s.$rootElement)||void 0===o?void 0:o.contains(e.el)))&&(l=T(t,a),null!=l)){const t=e.el,n="checkbox"===t.type,r="radio"===t.type,i=t.name,o=r?(null==s?void 0:s.$rootElement).querySelectorAll(`input[name="${i}"]`):[];if(l!==(n?t.checked:t.value))if(n)t.checked=Boolean(l);else if(r){let e=0;const t=o.length;for(e=0;e<t;e+=1){const t=o[e];if(t.value===l){t.checked=!0;break}}}else t.value=String(l)}})(e,o,0,r.forceRender)}),r.changeBinding&&n[i.change]&&n[i.change].length&&n[i.change].forEach(e=>{oe({bindingAttrs:i,cache:e,forceRender:r.forceRender,type:"change",viewModel:o})}),r.submitBinding&&n[i.submit]&&n[i.submit].length&&n[i.submit].forEach(e=>{Me({cache:e,forceRender:r.forceRender,type:"submit",viewModel:o})}),r.clickBinding&&n[i.click]&&n[i.click].length&&n[i.click].forEach(e=>{Me({cache:e,forceRender:r.forceRender,type:"click",viewModel:o})}),r.dblclickBinding&&n[i.dblclick]&&n[i.dblclick].length&&n[i.dblclick].forEach(e=>{Me({cache:e,forceRender:r.forceRender,type:"dblclick",viewModel:o})}),r.blurBinding&&n[i.blur]&&n[i.blur].length&&n[i.blur].forEach(e=>{Me({cache:e,forceRender:r.forceRender,type:"blur",viewModel:o})}),r.focusBinding&&n[i.focus]&&n[i.focus].length&&n[i.focus].forEach(e=>{Me({cache:e,forceRender:r.forceRender,type:"focus",viewModel:o})}),r.hoverBinding&&n[i.hover]&&n[i.hover].length&&n[i.hover].forEach(e=>{((e,t,n,r)=>{var i;const o=e.dataKey;let a=e.parameters;const l=d,s=u;let c;const f=t.APP||(null===(i=t.$root)||void 0===i?void 0:i.APP);e.elementData=e.elementData||{};const p=null==f?void 0:f.$rootElement;if(!o||!r&&p&&!p.contains(e.el))return;const h=T(t,o);if(h&&"function"==typeof h[l]&&"function"==typeof h[s]){c=K(t,o),a=a?V(t,a):[];const n=((e,t,n,r,i)=>function(o){const a=[o,e.el,...i];t[n].apply(r,a)})(e,h,l,c,a),r=((e,t,n,r,i)=>function(o){const a=[o,e.el,...i];t[n].apply(r,a)})(e,h,s,c,a);e.el.removeEventListener("mouseenter",n,!1),e.el.removeEventListener("mouseleave",r,!1),e.el.addEventListener("mouseenter",n,!1),e.el.addEventListener("mouseleave",r,!1)}})(e,o,0,r.forceRender)}),r.inputBinding&&n[i.input]&&n[i.input].length&&n[i.input].forEach(e=>{oe({bindingAttrs:i,cache:e,forceRender:r.forceRender,type:"input",viewModel:o})}))},ke={},xe=(e=null,t="",n,r=!1)=>{if(!(e&&"object"==typeof e&&"compId"in e&&e.compId&&t&&"function"==typeof n))return;let i,o=!1;t=t.replace(v.WHITE_SPACES,""),ke[t]=ke[t]||[];const a=e;o=ke[t].some(e=>!!e[a.compId]&&(e[a.compId]=n.bind(a.viewModel),e.isOnce=r,!0)),o||(i={},i[a.compId]=n.bind(a.viewModel),i.isOnce=r,ke[t].push(i))},$e=(e="",t="")=>{if(!e||!t)return;let n,r=0,i=0;if(t=t.replace(v.WHITE_SPACES,""),ke[t])for(i=ke[t].length,r=0;r<i;r+=1)if(n=ke[t][r],n[e]){ke[t].splice(r,1);break}ke[t]&&!ke[t].length&&delete ke[t]},Ne=Symbol("isReactiveProxy"),_e=Symbol("originalTarget");function je(e){return null!==e&&"object"==typeof e&&!0===e[Ne]}function Ie(e,t,n="",r){const{onChange:i,deep:o=!0,trackChanges:a=!1}=t;if(null===e||"object"!=typeof e)return e;if(je(e))return e;const l=["APP","$root","__proto__","constructor"];if(l.includes(n))return e;const s=r||(a?{changedPaths:new Set}:void 0),c=new Map;return new Proxy(e,{set(e,t,r){if("symbol"==typeof t)return e[t]=r,!0;if(e[t]===r)return!0;if(e[t]=r,c.delete(t),s){const e=n?`${n}.${String(t)}`:String(t);s.changedPaths.add(e)}return i(),!0},get(e,r){if(r===Ne)return!0;if(r===_e)return e;const a=e[r];if("function"==typeof a||"symbol"==typeof r||l.includes(String(r)))return a;if(o&&null!==a&&"object"==typeof a){if(c.has(r))return c.get(r);const e=n?`${n}.${String(r)}`:String(r),o=Array.isArray(a)?Ke(a,i,t,e,s):Ie(a,t,e,s);return c.set(r,o),o}return a},deleteProperty(e,t){if("symbol"==typeof t)return delete e[t],!0;if(delete e[t],c.delete(t),s){const e=n?`${n}.${String(t)}`:String(t);s.changedPaths.add(e)}return i(),!0}})}function Ke(e,t,n,r="",i){const{deep:o=!0}=n;if(je(e))return e;return new Proxy(e,{set(e,n,o){if("symbol"==typeof n)return e[n]=o,!0;if(e[n]===o)return!0;if(e[n]=o,i){const e=r?`${r}[${String(n)}]`:`[${String(n)}]`;i.changedPaths.add(e)}return t(),!0},get(e,a){if(a===Ne)return!0;if(a===_e)return e;const l=e[a];if("function"==typeof l){if(["push","pop","shift","unshift","splice","sort","reverse","fill"].includes(String(a)))return function(...e){const n=l.apply(this,e);return i&&i.changedPaths.add(r||"array"),t(),n}}if(o&&null!==l&&"object"==typeof l&&"symbol"!=typeof a){const e=r?`${r}[${String(a)}]`:`[${String(a)}]`;return Array.isArray(l)?Ke(l,t,n,e,i):Ie(l,n,e,i)}return l},deleteProperty(e,n){if("symbol"==typeof n)return delete e[n],!0;if(delete e[n],i){const e=r?`${r}[${String(n)}]`:`[${String(n)}]`;i.changedPaths.add(e)}return t(),!0}})}let Ve=0;class Le{constructor(e,n,r,i={}){var o;if(!e||1!==e.nodeType||null===n||"object"!=typeof n)throw new TypeError("$rootElement or viewModel is invalid");return this.initRendered=!1,this.compId=Ve+=1,this.$rootElement=e,this.bindingAttrs=r,this.isServerRendered=null!==this.$rootElement.getAttribute(t),this.afterRenderCallbacks=[],this.render=((e,t=null)=>function(e,t){let n=x(),r=0;return function(){const i=Array.from?Array.from(arguments):Array.prototype.slice.call(arguments);return window.cancelAnimationFrame(r),r=window.requestAnimationFrame(()=>{try{e.apply(t,i),n.resolve(t)}catch(e){console.error("error in rendering: ",e),n.reject(e)}n=x(),window.cancelAnimationFrame(r)}),n.promise}}(e,t))(this._render.bind(this),this),this.originalViewModel=n,this.isReactive=null===(o=i.reactive)||void 0===o||o,this.isReactive?"undefined"==typeof Proxy?(console.warn("Reactive mode requires Proxy support. Falling back to manual mode."),this.isReactive=!1,this.viewModel=n):this.viewModel=Ie(n,{onChange:()=>this.render(),deep:!0,trackChanges:i.trackChanges}):this.viewModel=n,this.viewModel.APP=this,this.viewModel.$root=this.viewModel,this.parseView(),this.$rootElement[l]=this.viewModel,this}parseView(){return this.elementCache=X({rootNode:this.$rootElement,bindingAttrs:this.bindingAttrs}),this.isServerRendered&&!this.initRendered&&this.updateElementCache({templateCache:!0}),this}updateElementCache(e={}){const t=e.elementCache||this.elementCache;if(e.allCache&&(this.elementCache=X({rootNode:this.$rootElement,bindingAttrs:this.bindingAttrs})),(e.allCache||e.templateCache)&&t[this.bindingAttrs.tmp]&&t[this.bindingAttrs.tmp].length)for(let n=0;n<t[this.bindingAttrs.tmp].length;n++){const r=t[this.bindingAttrs.tmp][n];let i=null;r.el.hasAttribute(this.bindingAttrs.forOf)&&(i=()=>!0),r.bindingCache=X({rootNode:r.el,bindingAttrs:this.bindingAttrs,skipCheck:i,isRenderedTemplate:e.isRenderedTemplates})}}_render(e={}){let n={};this.initRendered?n=Y("",e):this.isServerRendered?(this.$rootElement.removeAttribute(t),n=Y(f,e)):n=Y(p,e),this.postProcessQueue=[];const r={ctx:this,elementCache:this.elementCache,updateOption:n,bindingAttrs:this.bindingAttrs,viewModel:this.viewModel};var i;pe(r),De(r),(i=this.postProcessQueue)&&i.length&&N(i,(e,t)=>{if("function"==typeof t)try{t()}catch(e){J(e,`Error postProcess: ${String(t)}`)}}),this.postProcessQueue.length=0,delete this.postProcessQueue,this.initRendered=!0,this._callAfterRenderCallbacks()}_callAfterRenderCallbacks(){if(this.afterRenderCallbacks.length>0){const e=this.afterRenderCallbacks.slice();for(let t=0,n=e.length;t<n;t+=1)try{e[t]()}catch(e){console.error("Error in afterRender callback:",e)}}}afterRender(e){if("function"!=typeof e)throw new TypeError("afterRender callback must be a function");return this.afterRenderCallbacks.push(e),this}removeAfterRender(e){const t=this.afterRenderCallbacks.indexOf(e);return-1!==t&&this.afterRenderCallbacks.splice(t,1),this}clearAfterRender(){return this.afterRenderCallbacks.length=0,this}subscribe(e="",t){return xe(this,e,t),this}subscribeOnce(e="",t){return((e=null,t="",n)=>{xe(e,t,n,!0)})(this,e,t),this}unsubscribe(e=""){return $e(this.compId,e),this}unsubscribeAll(){return((e="")=>{e&&Object.keys(ke).forEach(t=>{$e(e,t)})})(this.compId),this}publish(e="",...t){return((e="",...t)=>{e&&ke[e]&&(e=e.replace(v.WHITE_SPACES,""),ke[e].forEach(n=>{Object.keys(n).forEach(r=>{if("function"==typeof n[r]){const i=n[r](...t);return n.isOnce&&$e(r,e),i}})}))})(e,...t),this}}const Fe="function"==typeof window.Promise;let He=e;return{use:(e={})=>{e.bindingAttrs&&(He=$(!1,{},e.bindingAttrs))},init:(e,t=null,n)=>Fe?new Le(e,t,He,n):console.warn("Browser not support Promise"),version:"@version@"}});
//# sourceMappingURL=dataBind.min.js.map
